(function(namespace,version){if(typeof namespace==="undefined"){namespace={}}else if(!(typeof namespace==="object"||typeof namespace==="function")){throw"Failed to initialize SVC - invalid namespace"}var svc=namespace.svc={};svc.VERSION=version;svc.Subject=Class.create({initialize:function(args){this._notificationToObservers={}},isEqual:function(subject){return this===subject},destroy:function(){this.notify("subject:destroy");this._notificationToObservers={}},notify:function(notification){var observers=this._notificationToObservers[notification];var args=Array.prototype.slice.call(arguments);args.shift();args.unshift(this);if(observers){_.invoke(observers,"apply",null,args)}},subscribe:function(notification,f){var observers=this._notificationToObservers[notification];if(observers){observers.push(f)}else{this._notificationToObservers[notification]=[f]}},unsubscribe:function(notification,f){var observers=this._notificationToObservers[notification];if(observers){this._notificationToObservers[notification]=_.without(observers,f)}}});svc.ModifiableSubject=Class.create(svc.Subject,{initialize:function($super,args){$super(args);this._dirty=false},get:function(property){return this[":"+property]},properties:function(){var properties=[];for(var property in this){if(property.charAt(0)===":"){properties.push(property.slice(1))}}return properties},clean:function(){this._dirty=false;this.notify("subject:clean")},dirty:function(){this._dirty=true;this.notify("subject:dirty")},set:function(property,value,silent){if(this.get(property)==value){return false}this[":"+property]=value;if(!silent){this.notify("subject:change:"+property);this.dirty()}return true},isDirty:function(){return this._dirty}});svc.Collection=Class.create(svc.Subject,{initialize:function($super,args){$super(args);this._collection=args.collection||[];this._sortFunction=args.sortFunction;if(this._sortFunction){this._collection=_.sortBy(this._collection,this._sortFunction,this._collection)}},at:function(index){if(!this.inRange(index)){throw"svc.Collection.at: invalid index."}return this._collection[index]},get:function(subject){return _.find(this._collection,function(entry){return entry.isEqual(subject)})},getAll:function(){return this._collection},indexOf:function(subject){var index=-1;_.find(this._collection,function(entry){++index;return _.isEqual(entry,subject)});return index===this.size()-1?-1:index},inRange:function(index){return index>=0&&index<this.size()},size:function(){return this._collection.length},add:function(subject){if(this.get(subject)){return}this._collection.push(subject);if(this._sortFunction){_.sortBy(this._collection,this._sortFunction)}this.notify("collection:add",subject);subject.notify("collection:add")},clear:function(){var cleared=this.getAll();this._collection=[];_.invoke(cleared,"notify","collection:clear");this.notify("collection:clear")},remove:function(subject){var entry=this.get(subject);if(!entry){return}this._collection=_.without(this._collection,entry);entry.notify("collection:remove");this.notify("collection:remove",entry);return entry}});svc.View=Class.create({initialize:function(args){this._subject=args.subject;this._element=this.draw();this._subscribedFunctions={};this.subscribe("subject:destroy",_.bind(this.tearDown))},draw:function(){throw"View.js: draw must be defined in a subclass."},update:function(){},tearDown:function(){var element=this.getElement();if(element){element.hide();var parentElement=element.parentNode;if(parentElement){parentElement.removeChild(element)}}this.unsubscribeAll()},getElement:function(){return this._element},getSubject:function(){return this._subject},subscribe:function(notification,fn){this._subscribedFunctions[notification]=fn;this.getSubject()&&this.getSubject().subscribe(notification,fn)},unsubscribe:function(notification){var fn=this._subscribedFunctions.get(notification);delete this._subscribedFunctions[notification];this.getSubject()&&this.getSubject().unsubscribe(notification,fn)},unsubscribeAll:function(){_.each(_.keys(this._subscribedFunctions),_.bind(this.unsubscribe,this))}});svc.ActionView=Class.create(svc.View,{initialize:function($super,args){this._action=args.action;this._controller=args.controller;this._field=null;$super(args);this._boundFireFunction=_.bind(this.fire,this);this.observeDOMEvents(args.events)},getField:function(){return this._field},observeDOMEvents:function(events){if(!this.getField()){return}if(!Object.isArray(events)){events=[events]}events.uniq().compact().each(function(event){this.getField().bind(event,this._boundFireFunction)}.bind(this))},fire:function(){var args=arguments;args.unshift(this.getSubject());this._controller[this._action].apply(this._controller,args)}});svc.Controller=Class.create({initialize:function(args){}});svc.AjaxController=Class.create(svc.Controller,{initialize:function($super,args){$super(args);this._actionPath=args.actionPath;this._actionMethod=args.actionMethod||"post"},makeRequest:function(args,callback){var boundOnSuccess=_.bind(this.onSuccess,this);var wrappedSuccess=callback&&typeof callback==="function"?_.bind(_.wrap(boundOnSuccess,callback),this):boundOnSuccess;$.ajax({data:_.extend(this.parameters(),args),dataType:"json",type:this.method(),url:this.path(),success:wrappedSuccess,complete:_.bind(this.onComplete,this),error:_.bind(this.onFailure,this)})},method:function(){if(!this._actionMethod){throw"AjaxController.js: method must be defined"}return this._actionMethod},onComplete:function(){},onCreate:function(){},onFailure:function(){},onSuccess:function(){},parameters:function(){return{}},path:function(){if(!this._actionPath){throw"AjaxController.js: path must be defined"}return this._actionPath}});svc.AjaxSingleRequestController=Class.create(svc.AjaxController,{initialize:function($super,args){$super(args);this._inProgress=false},makeRequest:function($super,args,callback){if(this._inProgress){return}this._inProgress=true;$super(args,callback)},onComplete:function(){this._inProgress=false}})})(null||function(){return this}(),"2.0");