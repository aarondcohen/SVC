(function(a,b){if(typeof a=="undefined")a={};else if(typeof a!="object"&&typeof a!="function")throw"Failed to initialize SVC - invalid namespace";var c=a.svc={};c.VERSION=b,c.Subject=Class.create({initialize:function(a){this._notificationToObservers=$H()},isEqual:function(a){return this===a},destroy:function(){this.notify("subject:destroy"),this._notificationToObservers=$H()},notify:function(a){var b=this._notificationToObservers.get(a),c=$A(arguments);c.shift(),c.unshift(this),b&&b.invoke("apply",null,c)},subscribe:function(a,b){var c=this._notificationToObservers.get(a);c?c.push(b):this._notificationToObservers.set(a,[b])},unsubscribe:function(a,b){var c=this._notificationToObservers.get(a);c&&this._notificationToObservers.set(a,c.without(b))}}),c.ModifiableSubject=Class.create(c.Subject,{initialize:function(a,b){a(b),this._dirty=!1},get:function(a){return this[":"+a]},properties:function(){var a=$A();for(var b in this)b.charAt(0)===":"&&a.push(b.slice(1));return a},clean:function(){this._dirty=!1,this.notify("subject:clean")},dirty:function(){this._dirty=!0,this.notify("subject:dirty")},set:function(a,b,c){return this.get(a)==b?!1:(this[":"+a]=b,c||(this.notify("subject:change:"+a),this.dirty()),!0)},isDirty:function(){return this._dirty}}),c.Collection=Class.create(c.Subject,{initialize:function(a,b){a(b),this._collection=$A(b.collection||[]),this._sortFunction=b.sortFunction,this._sortFunction&&this._collection.sort(this._sortFunction)},at:function(a){if(!this.inRange(a))throw"svc.Collection.at: invalid index.";return this._collection[a]},get:function(a){return this._collection.find(function(b){return b.isEqual(a)})},getAll:function(){return this._collection},indexOf:function(a){var b=-1;return this._collection.find(function(c){return++b,c.isEqual(a)}),b===this.size()?-1:b},inRange:function(a){return a>=0&&a<this.size()},size:function(){return this._collection.length},add:function(a){if(this.get(a))return;this._collection.push(a),this._sortFunction&&this._collection.sort(this._sortFunction),this.notify("collection:add",a),a.notify("collection:add")},clear:function(){var a=this.getAll();this._collection=$A(),a.invoke("notify","collection:clear"),this.notify("collection:clear")},remove:function(a){var b=this.get(a);if(!b)return;return this._collection=this._collection.without(b),b.notify("collection:remove"),this.notify("collection:remove",b),b},_each:function(a){this._collection._each(a)}}),c.Collection.addMethods(Enumerable),c.View=Class.create({initialize:function(a){this._subject=a.subject,this._element=this.draw(),this._subscribedFunctions=$H(),this.subscribe("subject:destroy",this.tearDown.bind(this))},draw:function(){throw"View.js: draw must be defined in a subclass."},update:function(){},tearDown:function(){var a=this.getElement();if(a){a.hide();var b=a.parentNode;b&&b.removeChild(a)}this.unsubscribeAll()},getElement:function(){return this._element},getSubject:function(){return this._subject},subscribe:function(a,b){this._subscribedFunctions.set(a,b),this.getSubject()&&this.getSubject().subscribe(a,b)},unsubscribe:function(a){var b=this._subscribedFunctions.get(a);this._subscribedFunctions.unset(a),this.getSubject()&&this.getSubject().unsubscribe(a,b)},unsubscribeAll:function(){this._subscribedFunctions.keys().each(this.unsubscribe.bind(this))}}),c.ActionView=Class.create(c.View,{initialize:function(a,b){this._action=b.action,this._controller=b.controller,this._field=null,a(b),this._boundFireFunction=this.fire.bind(this),this.observeDOMEvents(b.events)},getField:function(){return this._field},observeDOMEvents:function(a){if(!this.getField())return;Object.isArray(a)||(a=[a]),a.uniq().compact().each(function(a){this.getField().observe(a,this._boundFireFunction)}.bind(this))},fire:function(){var a=$A(arguments);a.unshift(this.getSubject()),this._controller[this._action].apply(this._controller,a)}}),c.Controller=Class.create({initialize:function(a){}}),c.AjaxController=Class.create(c.Controller,{initialize:function(a,b){a(b),this._actionPath=b.actionPath,this._actionMethod=b.actionMethod||"post"},makeRequest:function(a,b){var c=this.onSuccess.bind(this),d=b&&typeof b=="function"?c.wrap(b).bind(this):c,e=new Ajax.Request(this.path(),{method:this.method(),parameters:this.parameters().update(a),onCreate:this.onCreate.bind(this),onSuccess:d,onFailure:this.onFailure.bind(this),onComplete:this.onComplete.bind(this)})},method:function(){if(!this._actionMethod)throw"AjaxController.js: method must be defined";return this._actionMethod},onComplete:Prototype.emptyFunction,onCreate:Prototype.emptyFunction,onFailure:Prototype.emptyFunction,onSuccess:Prototype.emptyFunction,parameters:function(){return $H()},path:function(){if(!this._actionPath)throw"AjaxController.js: path must be defined";return this._actionPath}}),c.AjaxSingleRequestController=Class.create(c.AjaxController,{initialize:function(a,b){a(b),this._inProgress=!1},makeRequest:function(a,b,c){if(this._inProgress)return;this._inProgress=!0,a(b,c)},onComplete:function(){this._inProgress=!1}})})(function(){return this}(),"1.1");